## cruddy-website

[![](https://github.com/RowanGray472/cruddy-website/workflows/tests/badge.svg)](https://github.com/RowanGray472/cruddy-website/actions?query=workflow%3Atests)


This is a twitter clone I made using the full Instagram tech stack. Specifically, it uses nginx for the web load balancer, Flask+Gunicorn  for the web framework, pg\_bouncer for the database load balancer, and PostgreSQL for the database itself. Oh and also Docker. Way too much Docker.

The data I used was all fake and generated by yours truly. This would all work hooked up to real data though.

This website has a lot of features! You can view all tweets, all messages, login/logout, create a new account, and search through all messages. The search feature uses a RUM index to make it super speedy.

## Options

You can control how much data you add! Simply edit the top few lines of `execute_load_data.sh`. 

You can also enable or disable parallel processing here. If you don't want it, set `NUM_PROCESSES` to 1.

### Build Instructions

To build up this service for yourself you'll need to add three .env files after cloning the repo.

First is .env.prod.db. This is the file for your db passwords. It should look like this

```
POSTGRES_USER={your username}
POSTGRES_PASSWORD={your password}
POSTGRES_DB={your db name}
```

Next you'll need an .env.prodâ€”it should look like this.

```
FLASK_APP=project/__init__.py
FLASK_DEBUG=0
DATABASE_URL=postgresql://{your username}:{your password}@db:5432/{your db name}
SQL_HOST=db
SQL_PORT=5432
DATABASE={your db name}
APP_FOLDER=/home/app/web
```

Finally you need to make a .env.dev.container

```
FLASK_APP=project/__init__.py
FLASK_DEBUG=1
DATABASE_URL=postgresql://{your username}:{your password}@db:5432/{your db name}
SQL_HOST=db
SQL_PORT=5432
DATABASE={your db name}
APP_FOLDER=/usr/src/app
```

And if you want to run the index creation, account duplication, and data loading files in the dev you'll need an .env.dev.host

```
FLASK_APP=project/__init__.py
FLASK_DEBUG=1
DATABASE_URL=postgresql://{your username}:{your password}@localhost:5052/{your db name}
SQL_HOST=localhost
SQL_PORT=5052
DATABASE_NAME={your db name}
APP_FOLDER=./services/web
```

Once you've got these files built you're ready to go! All you need to do now is run the following to build and start all the services.

This will start the production db

```
$ docker compose -f docker-compose.prod.yml up -d --build
```

To load the data in run

```
$ docker compose exec web bash /home/app/web/execute_load_data.sh
```

And to create the index once you're done run

```
$ docker compose exec web python /home/app/web/create_index.py
```

To spin down the production container run

```
$ docker compose -f docker-compose.prod.yml down
```

And if you want to delete the data add a `-v` flag

The code is similar for dev. To start it up run

```
$ docker compose up -d --build
```

To add the data run

```
sh execute_load_data.sh
```

And to pull everything down run

```
docker compose down
```

Again, adding the `-v` flag if you want to delete the data.

